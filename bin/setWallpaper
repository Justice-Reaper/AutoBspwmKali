#!/bin/bash

wallpapers_dir="/home/user_replace/Wallpapers"
file_type=$(file -b --mime-type "$1" 2>/dev/null)

if [ $# -eq 1 ] && [[ "$1" == *.jpg ]] && [[ "$file_type" =~ ^image/ ]]; then
    count=1
    while [ -f "$wallpapers_dir/wallpaper-$count.jpg" ]; do
        ((count++))
    done

    image_exists=false
    for image in "$wallpapers_dir"/wallpaper-*.jpg; do
        if [ -f "$image" ] && cmp -s "$1" "$image"; then
            image_exists=true
            feh --bg-fill "$image" &
            echo "$(basename "$image")" > /home/user_replace/.config/bin/wallpaper
            break
        fi
    done

    if [ "$image_exists" = false ]; then
        new_wallpaper="wallpaper-$count.jpg"
        cp "$1" "$wallpapers_dir/$new_wallpaper"
        echo "âœ“ Image saved to $wallpapers_dir as wallpaper-$count.jpg"

        feh --bg-fill "$wallpapers_dir/$new_wallpaper" &
        echo "wallpaper-$count.jpg" > /home/user_replace/.config/bin/wallpaper
    fi

else
    echo "Error: You must provide a .jpg image"
    echo "Usage: $0 image.jpg"
    exit 1
fi
