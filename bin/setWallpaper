#!/bin/bash

wallpapers_dir="/home/user_replace/Wallpapers"

show_help() {
    echo "Usage: $(basename $0) -i IMAGE_FILE [OPTIONS]"
    echo ""
    echo "Options:"
    echo "  -i, --image FILE        Set the image as wallpaper"
    echo "  -s, --save-wallpaper    Save the image to wallpapers directory and set as permanent wallpaper"
    echo "  -h, --help              Show this help message"
    echo ""
    echo "Examples:"
    echo "  $(basename $0) -i photo.jpg"
    echo "  $(basename $0) -i photo.jpg -s"
    echo ""
}

while [[ $# -gt 0 ]]; do
    case $1 in
        -i|--image)
            image_file="$2"
            shift 2
            ;;
        -s|--set-wallpaper)
            set_wallpaper=true
            shift
            ;;
        -h|--help)
            show_help
            exit 0
            ;;
        *)
            echo "Error: Unknown parameter '$1'"
            echo "Use $(basename $0) -h/--help for usage information"
            exit 1
            ;;
    esac
done

file_type=$(file -b --mime-type "$image_file" 2>/dev/null)

if [ -z "$image_file" ] || [ ! -f "$image_file" ] || [[ ! "$file_type" =~ ^image/ ]]; then
    echo "Error: You must provide a valid image file"
    echo ""
    show_help
    exit 1
fi

count=1
while [ -f "$wallpapers_dir/wallpaper-$count.jpg" ]; do
    ((count++))
done

if [ "$set_wallpaper" = true ]; then
    echo "wallpaper-$count.jpg" > /home/user_replace/.config/bin/wallpaper
    cp "$image_file" "$wallpapers_dir/wallpaper-$count.jpg"
fi

feh --bg-fill "$image_file" &
