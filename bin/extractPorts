#!/bin/bash

script_name=$(basename "$0")

ports="$( (grep -oP '\d{1,5}/open' "$1" | awk -F'/' '{print $1}' | xargs | tr ' ' ',') 2>/dev/null )"
ip_address="$( (grep -oP '\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}' "$1" | sort -u | head -n 1) 2>/dev/null )"

if [ $# -ne 1 ] || [ -z "$ports" ] || [ -z "$ip_address" ]; then
    echo "Error: Could not extract information"
    echo "Usage: $script_name <nmap_grepeable_file>"

else
    echo -e "\n[*] Extracting information ...\n"
    echo -e "\t[*] IP Address: $ip_address"
    echo -e "\t[*] Open ports: $ports\n"

    echo -n "$ports" | xclip -sel clip

    if [ $? -eq 0 ]; then
        echo -e "[*] Ports copied to clipboard: $ports\n"
    fi
fi
